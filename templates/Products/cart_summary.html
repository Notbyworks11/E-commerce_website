{%extends 'core/base.html'%}

{% block extra_styles %}
<style>
    .row {
        margin-top: 10px;
    }
    .form-select-sm {
        width: auto; /* Adjust width if needed */
    }
    .quantity-label {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 10px; /* Adjust spacing as necessary */
    }
    .form-select-sm {
        width: auto; /* Adjust width if needed */
        display: inline-block; /* Ensures the select stays inline */
    }
</style>

{% endblock %}

{% block header %}
    

<header class="bg-dark py-2">
    <div class="container px-4 px-lg-5 my-5">
        <div class="text-center text-white">
  
            <h1 class="display-4 fw-bolder">Shopping Cart</h1>
            <p class="lead fw-normal text-white-50 mb-0"> View your Cart</p>
 
     

        </div>
    </div>
</header>

    

{% endblock  %}
    

{% block content %}
<br>
<div class="container">
    
    {% if cart_products%}
        

        
    {% for product in cart_products  %}
    <div class="card mb-3" style="max-width: 600px;">
        <div class="row g-0">
          <div class="col-md-4">
            <img src="{{product.image.url}}" class="img-fluid rounded-start" alt="...">
          </div>
          <div class="col-md-8">
            <div class="card-body">
                <center>
              <h5 class="card-title">{{product.name}}</h5>
              <p class="card-text">{{product.description}}</p>
              
              {% if product.is_sale %}
              <div class="card-body p-4">
                <div class="text-center">
                    <!-- Product name-->
                    <h5 class="fw-bolder">{{product.name}}</h5>
                    <!-- Product price-->
                    <strike>£{{product.price}}</strike>
                    &nbsp;
                    £{{product.sale_price}}
                </div>
            </div>
    
              {% else %}
                £{{product.price}} 
                
              {% endif %}
              <br>
              <div class="row justify-content-center">
                    <div class="col-md-2 quantity-label">Quantity:</div>
                    <div class="col-md-2"><select class="form-select form-select-sm" id="select{{product.id}}" >
                        <option seletected>
                            
                            {% for key,value in quantities.items %}
                                
                                {% if key == product.id|slugify %}
                                    {{value.quantity}}
                                {% else %}

                                    
                                {% endif %}
                                    
                            {% endfor %}
                                

                        </option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                      </select>
                    </div>

              </div>
              
              <br>
                
              <a href="{% url 'index' %}" class ="btn btn-secondary">Back</a>
              <button type="button" data-index = "{{product.id}}" class="btn btn-secondary update-cart"  >Update</button>
              <button type="button" data-index = "{{product.id}}" class="btn btn-danger delete-product"  >Remove</button>
            </center>
            </div>
    
          </div>
        </div>
      </div><hr>

     

    {% endfor %}
    <h3>Total:£{{totals}} </h3>
    <br><br><br>
    {% else %}
    There is nothing in your cart.
    {% endif %}
        
</div>
<br><br><br><br><br><br><br><br><br>
<script>
    //update Cart
    $(document).on('click', '.update-cart', function(e) {
        e.preventDefault();
        // Get the selected quantity from the dropdown
        
        var productid = $(this).data('index');
        var selectedQty=$('#select' + productid + ' option:selected').val();
        $.ajax({
            type: 'POST',
            url: '{% url 'cart_update' %}', // URL for adding items to cart
            data: {
                product_id: $(this).data('index'),
                product_qty: selectedQty, // Default quantity
                csrfmiddlewaretoken: '{{ csrf_token }}',
                action: 'post'
            },
            success: function(json) {
                //console.log(json); // Debugging line to check response
                //document.getElementById("cart_quantity").textContent = json.qty; // Update cart quantity display
                location.reload();
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText); // Debugging line to check errors
            }
        });
    });
    //Remove item
    $(document).on('click', '.delete-product', function(e) {
        e.preventDefault();
        // Get the selected quantity from the dropdown
        
        //var productid = $(this).data('index');
        //var selectedQty=$('#select' + productid + ' option:selected').val();
        $.ajax({
            type: 'POST',
            url: '{% url 'cart_delete' %}', // URL for adding items to cart
            data: {
                product_id: $(this).data('index'),
                csrfmiddlewaretoken: '{{ csrf_token }}',
                action: 'post'
            },
            success: function(json) {
                //console.log(json); // Debugging line to check response
                //document.getElementById("cart_quantity").textContent = json.qty; // Update cart quantity display
                location.reload();
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText); // Debugging line to check errors
            }
        });
    });
    </script>
{% endblock %}
